# Postfix Integration

This is a community developed integration designed to parse logs from [Postfix mail servers](https://www.postfix.org/). The plug-in supports 

## Compatibility
The `log` ingestion pipeline was tested with logs from Postfix version 3.8.6 running on Ubuntu 24. 

Currently this integration supports parsing logs from the Postfix anvil, cleanup, error, local, master, pickup, postfix-script, qmgr, scache, smtp, and smtpd processes with additional support for [OpenDKIM](http://www.opendkim.org/) and [policyd-spf](https://manpages.debian.org/testing/postfix-policyd-spf-python/policyd-spf.1.en.html). All other events are dropped.

**Exported fields**
| Field | Description | Type |
|---|---|---|
| @timestamp | Date/time when the event originated. This is the date/time extracted from the event, typically representing when the event was generated by the source. If the event source has no original timestamp, this value is typically populated by the first time the event was received by the pipeline. Required field for all events. | date |
| client.address | Some event client addresses are defined ambiguously, as the event may list an IP address, a domain, or a Unix socket. This field contains the raw address. The `client.ip` or `client.domain` field contains the appropriate values based on whether this field contains an IP address or a hostname, respectively. | keyword |
| client.as.number | Unique number allocated to the autonomous system. The autonomous system number (ASN) uniquely identifies each network on the Internet. | long |
| client.as.organization.name | Organization name. | keyword |
| client.domain | The domain name of the client system. This value may be a host name, a fully qualified domain name, or another host naming format. | keyword |
| client.geo.city_name | City name. | keyword |
| client.geo.continent_code | Two-letter code representing continent’s name. | keyword |
| client.geo.continent_name | Name of the continent. | keyword |
| client.geo.country_iso_code | Country ISO code. | keyword |
| client.geo.country_name | Country name. | keyword |
| client.geo.location | Latitude and Longitude. | geo_point |
| client.geo.region_iso_code | Region ISO code. | keyword |
| client.geo.region_name | Region name. | keyword |
| client.ip | IP address of the client (IPv4 or IPv6). | ip |
| client.registered_domain | The highest registered client domain, stripped of the subdomain. For example, the registered domain for "foo.example.com" is "example.com". | keyword |
| client.subdomain | The subdomain portion of a fully qualified domain name includes all of the names except the host name under the registered_domain. In a partially qualified domain, or if the the qualification level of the full name cannot be determined, subdomain contains all of the names below the registered domain. For example the subdomain portion of "www.east.mydomain.co.uk" is "east". If the domain has multiple levels of subdomain, such as "sub2.sub1.example.com", the subdomain field will contain "sub2.sub1", with no trailing period.
| client.top_level_domain | The effective top level domain (eTLD), also known as the domain suffix, is the last part of the domain name. For example, the top level domain for example.com is "com". | keyword |
| ecs.version | ECS version this event conforms to. When querying across multiple indices — which may conform to slightly different ECS versions — this field lets integrations adjust to the schema version of the events. | keyword |
| email.direction | Not yet implemented. | keyword |
| email.from.address | The email address of the sender. | keyword |
| email.local_id | Unique identifier given to the email by the source that created the event. Identifier is not persistent across hops. | keyword |
| email.message_id | Identifier from the RFC 5322 `Message-ID:` email header that refers to a particular email message. | wildcard |
| email.to.address | The email address of the recipient. **Note:** If one or more recipients of an email are [local](https://www.postfix.org/aliases.5.html), [virtual](https://www.postfix.org/virtual.5.html), or remote aliases, this field will contain the address of the local or virtual non-alias/resolved email address. The address of the orginal `email.to.address` alias is stored in `postfix.email.to.original_address`. | keyword |
| data_stream.dataset | Data stream dataset name. `postfix.log` | constant_keyword |
| data_stream.type | Data stream type. `logs` | constant_keyword |
| data_stream.namespace | A user defined namespace. Namespaces are useful to allow grouping of data. Many users already organize their indices this way, and the data stream naming scheme now provides this best practice as a default. Many users will populate this field with `default`. If no value is used, it falls back to `default`. Beyond the Elasticsearch index naming criteria noted above, namespace value has the additional restrictions: <ul><li>Must not contain -</li><li>No longer than 100 characters</li></ul> | constant_keyword |
| error.code | Error code describing the error. **Note:** This field is reserved and populated by elasticsearch if errors occur during document/event ingestion. See `postfix.error.code` for errors reported by Postfix. | keyword |
| error.id | Unique identifier for the error. **Note:** This field is reserved and populated by elasticsearch if errors occur during document/event ingestion. See `postfix.error.id` for errors reported by Postfix. | keyword |
| error.message | Error message. **Note:** This field is reserved and populated by elasticsearch if errors occur during document/event ingestion. See `postfix.error.message` for errors reported by Postfix. | match_only_text |
| error.type | The type of the error, for example the class name of the exception. **Note:** This field is reserved and populated by elasticsearch if errors occur during document/event ingestion. See `postfix.error.type` for errors reported by Postfix. | keyword |
| event.action | The action captured by the event. This describes the information in the event. It is more specific than event.category. Possible values are `process-starting`, `process-stopping`, `process-reloading`, `process-started`, `process-stopped`, `process-reloaded`, `smtpd-connect` and `smtpd-disconnect`. | keyword |
| event.category | This is one of four ECS Categorization Fields, and indicates the second level in the ECS category hierarchy. This field is an array allowing for proper categorization of some events that fall into multiple categories. This integration implements three event categories:<ul><li>`email`: events related to the delivery, status, or movement of email messages.</li><li>`process`: postfix process starting, stopping, and reloading events.</li><li>`session`: remote system connect and disconnect events and session related metrics.</ul>| keyword |
| event.dataset | Name of the dataset. `postfix.log` | constant_keyword |
| event.kind | This is one of four ECS Categorization Fields, and indicates the highest level in the ECS category hierarchy. This integration implements the `event` category. **Note:** `event.kind` can be set to `pipeline_error` by elasticsearch if an ingestion error occurs during pipeline processing.| keyword |
| event.module | Name of the postfix sub-process this data is coming from. Example values: `anvil`, `cleanup`, `lmtp`, `local`, `master`, `opendkim`, `pickup`, `policyd-spf`, `script`, `qmgr`, `scache`, `smtp`, or `smtpd`. | keyword |
| event.provider | This field will be populated when the event’s timestamp does not include timezone information already of the event. Example: `postfix` | keyword |
| event.timezone | This field should be populated when the event's timestamp does not include timezone information already (e.g. default Syslog timestamps). It's optional otherwise. Acceptable timezone formats are: a canonical ID (e.g. "Europe/Amsterdam"), abbreviated (e.g. "EST") or an HH:mm differential (e.g. "-05:00"). See also the Timezone Offset agent setting.| keyword |
| event.type | This is one of four ECS Categorization Fields, and indicates the third level in the ECS category hierarchy. event.type represents a categorization "sub-bucket" that, when used along with the event.category field values, enables filtering events down to a level appropriate for single visualization.</br> This field is an array. This will allow proper categorization of some events that fall in multiple event types. | keyword |
| host.ip | IP address(es) of the host where this event originated. Note: this field can contain an array of values.| ip |
| host.name | Name of the host. It can contain what hostname returns on Unix systems, the fully qualified domain name (FQDN), or a name specified by the user. | keyword |
| input.type| Type of Filebeat input. `filestream`| keyword |
| log.file.path | Full path to the log file this event came from, including the file name. | keyword |
| log.level | Log level of the log event. Can be one of: `info`, `warn`, or `error`.| keyword |
| postfix.anvil.connection.cache_size | Maximum connection cache size as reported in Anvil statistics events. | long |
| **--[ LEFT OFF HERE ]--** |
| postfix.email.to.orginal_address | Original intended recipient of an email. This field is most often populated in cases where the to address for a recipient is modified by Postfix due to [local](https://www.postfix.org/aliases.5.html), [virtual](https://www.postfix.org/virtual.5.html), or remote aliasing. | keyword |
| process.end | The time the process ended. Note that the process.end timestamp will only populate in instances where the postfix process was terminated gracefully.| date |
| process.exit_code | The exit code of the process, if this is a termination event. | long |
| process.name | Process name. Sometimes called program name or similar. | keyword |
| process.name.text | Multi-field of `process.name`. | match_only_text |
| process.pid | Process id. | long | 
| process.pgid | Deprecated for removal in next major version release. This field is superseded by `process.group_leader.pid`. Identifier of the group of processes the process belongs to. | long |
| process.start | The time the process started. | date |
| server.address | Some event server addresses are defined ambiguously, as the event may list an IP address, a domain, or a Unix socket. This field contains the raw address. The `server.ip` or `server.domain` field contains the appropriate values based on whether this field contains an IP address or a hostname, respectively. | keyword |
| server.as.number | Unique number allocated to the autonomous system. The autonomous system number (ASN) uniquely identifies each network on the Internet. | long |
| server.as.organization.name | Organization name. | keyword |
| server.domain | The domain name of the  server system. This value may be a host name, a fully qualified domain name, or another host naming format. | keyword |
| server.geo.city_name | City name. | keyword |
| server.geo.continent_code | Two-letter code representing continent’s name. | keyword |
| server.geo.continent_name | Name of the continent. | keyword |
| server.geo.country_iso_code | Country ISO code. | keyword |
| server.geo.country_name | Country name. | keyword |
| server.geo.location | Latitude and Longitude. | geo_point |
| server.geo.region_iso_code | Region ISO code. | keyword |
| server.geo.region_name | Region name. | keyword |
| server.ip | IP address of the server (IPv4 or IPv6). | ip |
| server.registered_domain | The highest registered server domain, stripped of the subdomain. For example, the registered domain for "foo.example.com" is "example.com". | keyword |
| server.subdomain | The subdomain portion of a fully qualified domain name includes all of the names except the host name under the registered_domain. In a partially qualified domain, or if the the qualification level of the full name cannot be determined, subdomain contains all of the names below the registered domain. For example the subdomain portion of "www.east.mydomain.co.uk" is "east". If the domain has multiple levels of subdomain, such as "sub2.sub1.example.com", the subdomain field will contain "sub2.sub1", with no trailing period.
| server.top_level_domain | The effective top level domain (eTLD), also known as the domain suffix, is the last part of the domain name. For example, the top level domain for example.com is "com". | keyword |
| server.port | Port of the server. | long |
| tags | List of keywords used to tag each event. | keyword |
| tls.cipher | String indicating the cipher used during the current connection. | keyword |
| tls.established | Boolean flag indicating if the TLS negotiation was successful and transitioned to an encrypted tunnel. | boolean |
| tls.version | Numeric part of the version parsed from the original string. | keyword |
| tls.version_protocol | Normalized lowercase protocol name parsed from original string. | keyword |
| user.id | Unique identifier of the user. | keyword |